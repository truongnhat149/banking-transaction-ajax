<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List of customers</title>
    <link rel="stylesheet" href="./css/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="./css/font-awesome/css/all.css">
    <link rel="stylesheet" href="./css/styles.css">
    <script src="./js/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="./js/jquery-3.6.0.min.js"></script>
    <script src="./customer.js"></script>
    <script src="./app.js"></script>
    <script src="./js/jquery.validate.js"></script>
    <script src="./js/jquery.validate.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="table-title">
            <div class="row">
                <div class="col-sm-5">
                    <h1>List of customers</h1>
                </div>
                <div class="col-sm-7">
                    <button type="button" class="btn btn-outline-light" data-bs-toggle="modal"
                        data-bs-target="#createModal">
                        <i class="fa-solid fa-plus"></i>
                        <span>Add New Customer</span>
                    </button>
                    <a href="#" class="btn btn-outline-light">
                        <i class="fa fa-history" aria-hidden="true"></i>
                        <span>Transfer money Information</span>
                    </a>
                </div>
            </div>
        </div>
        <div>
            <table class="table table-hover table-borderless">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Full Name</th>
                        <th>Email</th>
                        <th>phone</th>
                        <th>Address</th>
                        <th>Balance</th>
                        <th colspan="5" class="text-center">Action</th>
                    </tr>
                </thead>
                <tbody id="tbCustomer">
                </tbody>
            </table>
        </div>
    </div>

    <!-- Create Modal -->
    <div class="modal fade" id="createModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Create Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="frmCreate">
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="fullName" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="fullName">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label">Phone</label>
                                <input type="number" class="form-control" id="phone">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="address" class="form-label">Address</label>
                                <input type="text" class="form-control" id="address">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="btnCreate" class="btn btn-outline-primary">Create</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Modal -->
    <div class="modal fade" id="updateModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Update Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="frmUpdate">
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="fullNameUp" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="fullNameUp">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="emailUp" class="form-label">Email</label>
                                <input type="email" class="form-control" id="emailUp">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="phoneUp" class="form-label">Phone</label>
                                <input type="number" class="form-control" id="phoneUp">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="addressUp" class="form-label">Address</label>
                                <input type="text" class="form-control" id="addressUp">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="btnUpdate" class="btn btn-outline-secondary">Update</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Delete -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabelDelete">Delete customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="idDelete">
                    <div style="text-align: center;">
                        <img src="/image/warming.svg" alt="waiting">
                        <h3>Are you sure delete customer !</h3>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-outline-primary" data-bs-dismiss="modal"
                       >Yes, delete it !
                    </button>
                    <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Cancle</button>

                </div>
            </div>
        </div>
    </div>


    <!-- Deposit Modal -->
    <div class="modal fade" id="depositModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Deposit money into customer's account</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="modal-alert-danger hide"></div>
                    <form id="frmDeposit" method="post">
                        <fieldset class="row g-3">
                            <div class="mb-3 col-md-6">
                                <div class="form-group row">
                                    <label class="col-sm-12 col-form-label">Customer ID</label>
                                    <div class="col-sm-12">
                                        <input type="text" id="customerIdDep" name="customerIdDep" class="form-control"
                                            readonly />
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3 col-md-6">
                                <div class="form-group row">
                                    <label class="col-sm-12 col-form-label">Full Name</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control" id="fullNameDep" name="fullNameDep"
                                            readonly />
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3 col-md-6">
                                <div class="form-group row">
                                    <label class="col-sm-12 col-form-label">Current balance ($)</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control num-space" id="balanceDep"
                                            name="balanceDep" readonly />
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3 col-md-6">
                                <div class="form-group row">
                                    <label for="transactionAmountDep" class="col-sm-12 col-form-label">Transaction Amount ($)</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control num-space" id="transactionAmountDep"
                                            name="transactionAmountDep" />
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="btnDepositMoney" class="btn btn-outline-success">
                        <i class="fa fa-plus" aria-hidden="true"></i>
                        Deposit
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Withdraw -->
    <div class="modal fade" id="withdrawModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" >Withdraw money into customer's account</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <div class="modal-alert-danger hide"></div>
                    <form id="frmWithdraw" method="post">
                        <fieldset class="row g-3">
                            <div class="mb-3 col-md-6">
                                <div class="form-group row">
                                    <label class="col-sm-12 col-form-label">Customer ID</label>
                                    <div class="col-sm-12">
                                        <input type="text" id="customerIdWd" name="customerIdWd" class="form-control" readonly />
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3 col-md-6">
                                <div class="form-group row">
                                    <label class="col-sm-12 col-form-label">Full Name</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control" id="fullNameWd" name="fullNameWd" readonly />
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3 col-md-6">
                                <div class="form-group row">
                                    <label class="col-sm-12 col-form-label">Current balance ($)</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control num-space" id="currentBalanceWd" name="currentBalanceWd" readonly />
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3 col-md-6">
                                <div class="form-group row">
                                    <label class="col-sm-12 col-form-label">Transaction Amount ($)</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control num-space" id="transactionAmountWd" name="transactionAmountWd" />
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="btnWithdrawMoney" class="btn btn-outline-warning">
                        <i class="fa fa-minus" aria-hidden="true"></i>
                        Deposit
                    </button>
                </div>
            </div>
        </div>

    </div>


    

    <!-- Modal Transfer -->
    <div class="modal fade" id="modalTransfer" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog  modal-dialog-centered modal-dialog-scrollable modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Transfer money into customer's account</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="modal-alert-danger hide"></div>

                    <form id="frmTransfer" method="post">
                        <fieldset class="row g-3">

                            <div class="row">
                                <div class="col-md-4">
                                    <label for="senderID" class="form-label">Sender ID</label>
                                    <input type="text" class="form-control" name="senderID" id="senderID" readonly>
                                    
                                </div>
                                <div class="col-md-4">
                                    <label for="senderName" class="form-label">Sender Name</label>
                                    <input type="text" class="form-control" name="senderName" id="senderName" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="senderEmail" class="form-label">Email</label>
                                    <input type="text" class="form-control" name="senderEmail" id="senderEmail" readonly>
                                </div>
        
        
                                <div class="col-md-6">
                                    <label for="senderBalance" class="form-label">Sender balance (VND)</label>
                                    <input type="text" class="form-control" name="senderBalance" id="senderBalance" readonly>
        
                                </div>
        
                                <div class="col-md-6">
                                    <label for="recipientName" class="form-label">Recipient Name</label>
                                    <select class="form-select mb-3" id="recipientName" name="recipientName">
                                        <option value="">Recipient Name</option>
                                    </select>
                                </div>
        
                                <div class="col-md-4">
                                    <label for="transferAmount" class="form-label">Transfer Amount (VND)</label>
                                    <input type="number" class="form-control" name="transferAmount" id="transferAmount">
        
                                </div>
                                <div class="col-md-4">
                                    <label for="fees" class="form-label">Fees(%)</label>
                                    <input type="text" class="form-control" name="fees" id="fees" value="10" readonly>
                                </div>
                                <div class="col-md-4">
                                    <label for="totalTransactionAmount" class="form-label">Total amount of transaction</label>
                                    <input type="text" class="form-control" name="totalTransactionAmount"
                                        id="totalTransactionAmount" readonly>
                                </div>
                        </fieldset>
                    </form>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="btnTransferMoney" class="btn btn-outline-primary" data-bs-dismiss="modal" >
                        <i class="fas fa-exchange-alt"></i>
                        Transfer
                    </button>
                </div>
            </div>
        </div>
    </div>

    </div>

    <script>
        let customer = new Customer();
        let deposit = new Deposit();
        let withdraw = new Withdraw();
        let transfer = new Transfer();
        

    function findById(id) {
            return $.ajax({
                headers: {
                    "Content": "application/json",
                    "Accept": "application/json"
                },
                url: "http://localhost:3000/customers/" + id,
                success: function (data) {
                    customer = data;
                },
                error: function () {

                }
            })
        }

    function drawListCustomers(data) {
            let str = `
                <tr id="tr_${data.id}">
                    <td>${data.id}</td>
                    <td>${data.fullName}</td>
                    <td>${data.email}</td>
                    <td>${data.phone}</td>
                    <td>${data.address}</td>
                    <td>${data.balance}</td>
                    <td>
                        <button type="button" data-id="${data.id}" data-full-name="${data.fullName}" class="btn btn-outline-secondary btn-update">
                            <i class="fa-solid fa-pen-to-square"></i>
                        </button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-outline-success btn-deposit" data-id="${data.id}">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-outline-warning btn-withdraw" data-id="${data.id}">
                            <i class="fa-solid fa-minus"></i>
                        </button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-outline-primary btn-transfer" data-id="${data.id}">
                            <i class="fa-solid fa-arrow-right-arrow-left"></i>
                        </button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-outline-danger btn-delete" data-id="${data.id}"">
                            <i class="fa-solid fa-ban"></i>
                        </button>
                    </td>
                </tr>
    `;

            document.getElementById("tbCustomer").innerHTML += str;
        }

    function loadCustomers() {
            return $.ajax({
                headers: {
                    "Content": "application/json",
                    "Accept": "application/json"
                },
                url: "http://localhost:3000/customers",
                success: function (data) {
                    data.forEach(item => {
                        drawListCustomers(item);
                    });
                }
            })
        }

        // Update
    function handlerShowUpdateModal() {
            let btnUpdate = $(".btn-update");

            btnUpdate.on("click", function () {
                let id = $(this).data("id");

                findById(id).then(function () {
                    $("#fullNameUp").val(customer.fullName);
                    $("#emailUp").val(customer.email);
                    $("#phoneUp").val(customer.phone);
                    $("#addressUp").val(customer.address);

                    $("#updateModal").modal("show");
                }).catch(function () {
                    alert("Customer not found!");
                });
            });
        }

    function doUpdate() {

        let customer = {
            id: null,
            fullName: $("#fullNameUp").val(),
            email: $("#emailUp").val(),
            phone: $("#phoneUp").val(),
            address: $("#addressUp").val(),
            balance: 0
        }

        $.ajax({
            type: "PUT",
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            url: "http://localhost:3000/customers/" + customer.id,
            data: JSON.stringify(customer),
            success: function (data) {
                let str = `
            <tr id="tr_${data.id}">
                <td>${data.id}</td>
                <td>${data.fullName}</td>
                <td>${data.email}</td>
                <td>${data.phone}</td>
                <td>${data.address}</td>
                <td>${data.balance}</td>
                <td>
                    <button type="button" data-id="${data.id}" data-full-name="${data.fullName}" class="btn btn-outline-secondary btn-update">
                        <i class="fa-solid fa-pen-to-square"></i>
                    </button>
                </td>
                <td>
                    <button type="button" class="btn btn-outline-success btn-deposit" data-id="${data.id}">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </td>
                <td>
                    <button type="button" class="btn btn-outline-warning btn-withdraw" data-id="${data.id}">
                        <i class="fa-solid fa-minus"></i>
                    </button>
                </td>
                <td>
                    <button type="button" class="btn btn-outline-primary btn-transfer" data-id="${data.id}">
                        <i class="fa-solid fa-arrow-right-arrow-left"></i>
                    </button>
                </td>
                <td>
                    <button type="button" class="btn btn-outline-danger btn-delete" data-id="${data.id}"">
                        <i class="fa-solid fa-ban"></i>
                    </button>
                </td>
            </tr>
        `;

                let currentRow = $("#tr_" + data.id);
                currentRow.replaceWith(str);

                $("#updateModal").modal("hide");

                handlerShowUpdateModal();
            }
        })
        }

        $("#btnUpdate").on("click", function () {
            doUpdate();
        });


        // delete
        function handlerShowDeleteModal() {
            let btnDelete = $(".btn-delete");

            btnDelete.on("click", function() {
                let id = $(this).data("id");

                findById(id).then(function() {
                    $("#deleteModal").modal("show");
                }).catch(function () {
                    alert("Customer not found");
                }) 
            })
        }

        // deposit
        function handlerShowDepositModal() {
            let btnDeposit = $(".btn-deposit");

            btnDeposit.on("click", function () {

                let id = $(this).data("id");

                findById(id).then(function () {
                    $("#customerIdDep").val(customer.id);
                    $("#fullNameDep").val(customer.fullName);
                    $("#balanceDep").val(customer.balance);

                    $("#depositModal").modal("show");
                }).catch(function () {
                    alert("Customer not found!");
                });
            })
        }

        function doDeposit() {

            deposit.customerId = customer.id;
            deposit.transactionAmount = +$("#transactionAmountDep").val();

            customer.balance += +deposit.transactionAmount;

            $.ajax({
                type: "POST",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                url: "http://localhost:3000/deposits",
                data: JSON.stringify(deposit),
                success: function () {

                }
            });

            $.ajax({
                type: "PUT",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                url: "http://localhost:3000/customers/" + customer.id,
                data: JSON.stringify(customer),
                success: function (data) {
                    let str = `
                <tr id="tr_${data.id}">
                    <td>${data.id}</td>
                    <td>${data.fullName}</td>
                    <td>${data.email}</td>
                    <td>${data.phone}</td>
                    <td>${data.address}</td>
                    <td>${data.balance}</td>
                    <td>
                        <button type="button" data-id="${data.id}" data-full-name="${data.fullName}" class="btn btn-outline-secondary btn-update">
                            <i class="fa-solid fa-pen-to-square"></i>
                        </button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-outline-success btn-deposit" data-id="${data.id}">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-outline-warning btn-withdraw" data-id="${data.id}">
                            <i class="fa-solid fa-minus"></i>
                        </button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-outline-primary btn-transfer" data-id="${data.id}">
                            <i class="fa-solid fa-arrow-right-arrow-left"></i>
                        </button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-outline-danger btn-delete" data-id="${data.id}"">
                            <i class="fa-solid fa-ban"></i>
                        </button>
                    </td>
                </tr>
            `;

                    let currentRow = $("#tr_" + data.id);
                    currentRow.replaceWith(str);

                    $("#depositModal").modal("hide");

                    handlerShowUpdateModal();

                    handlerShowDepositModal();
                }
            });
        }

        $("#btnDepositMoney").on("click", function () {

            $("#frmDeposit").submit();
        });


        $("#depositModal").on("hidden.bs.modal", function () {
            $('#frmDeposit')[0].reset();
            $('#frmDeposit').validate().resetForm();
            $("input.error").removeClass("error");
        });

        $("#frmDeposit").validate({
            rules: {
                transactionAmountDep: {
                    required: true,
                    min: 50,
                    max: 10000000000
                }
            },
            messages: {
                transactionAmountDep: {
                    required: "Transaction amount is required",
                    min: "Transaction amount min is 50",
                    max: "Transaction amount max is 10.000.000.000"
                }
            },
            submitHandler: function () {
                doDeposit();
            }
        });


        //withdraw
        function handlerShowWithdrawModal() {

            let btnWithdraw = $(".btn-withdraw");

            btnWithdraw.on("click", function () {
                let id = $(this).data("id");

                findById(id).then(function () {
                    $("#customerIdWd").val(customer.id);
                    $("#fullNameWd").val(customer.fullName);
                    $("#currentBalanceWd").val(customer.balance);

                    $("#withdrawModal").modal("show");
                }).catch(function () {
                    alert("Customer not found");
                })
            })
        }

        function doWithdraw() {

            withdraw.customerId = customer.id;
            withdraw.transactionAmount = +$("#transactionAmountWd").val();

            customer.balance -= withdraw.transactionAmount;

            $.ajax({
                type: "POST",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                url: "http://localhost:3000/withdraws",
                data: JSON.stringify(withdraw),
                success: function () {

                }
            });

            $.ajax({
                type: "PUT",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                url: "http://localhost:3000/customers/" + customer.id,
                data: JSON.stringify(customer),
                success: function (data) {
                    let str =
                        `
                        <tr id="tr_${data.id}">
                            <td>${data.id}</td>
                            <td>${data.fullName}</td>
                            <td>${data.email}</td>
                            <td>${data.phone}</td>
                            <td>${data.address}</td>
                            <td>${data.balance}</td>
                            <td>
                                <button type="button" data-id="${data.id}" data-full-name="${data.fullName}" class="btn btn-outline-secondary btn-update">
                                    <i class="fa-solid fa-pen-to-square"></i>
                                </button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-outline-success btn-deposit" data-id="${data.id}">
                                    <i class="fa-solid fa-plus"></i>
                                </button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-outline-warning btn-withdraw" data-id="${data.id}">
                                    <i class="fa-solid fa-minus"></i>
                                </button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-outline-primary btn-transfer" data-id="${data.id}">
                                    <i class="fa-solid fa-arrow-right-arrow-left"></i>
                                </button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-outline-danger btn-delete" data-id="${data.id}"">
                                    <i class="fa-solid fa-ban"></i>
                                </button>
                            </td>
                        </tr>
            `;

                    let currentRow = $("#tr_" + data.id);
                    currentRow.replaceWith(str);

                    $("#withdrawModal").modal("hide");

                    handlerShowUpdateModal();

                    handlerShowWithdrawModal();
                }
            })
        }

        $("#btnWithdrawMoney").on("click", function () {

            $("#frmWithdraw").submit();
        });

        $("#withdrawModal").on("hidden.bs.modal",function() {
            $('#frmWithdraw')[0].reset();
            $('#frmWithdraw').validate().resetForm();
            $("input.error").removeClass("error");
        })
        
        $("#frmWithdraw").validate({
            rules: {
                transactionAmountWd: {
                    required: true,
                    min : 50,
                    max : 10000000000
                }
            },
            messages: {
                transactionAmountWd: {
                    required: "Transaction amount is required",
                    min: "Transaction amount min is 50",
                    max : "Transaction amount max 10.000.000.000"
                }
            },
            submitHandler: function() {
                doWithdraw();
            }
        })

        // transfer
        function handlerShowTransferModal() {
            let btnTransfer = $(".btn-transfer");
            let evenOnchange = $("#transferAmount");

            btnTransfer.on("click", function() {
                let id = $(this).data("id");

                findById(id).then(function() {
             
                    $("#senderID").val(customer.id);
                    $("#senderName").val(customer.fullName);
                    $("#senderEmail").val(customer.email);
                    $("#senderBalance").val(customer.balance);
                   
                    evenOnchange.keyup(function () {
                        $("#totalTransactionAmount").val(Math.floor(+$("#transferAmount").val() + (+$("#transferAmount").val()/ 10)));
                    })

                    $.ajax({
                        headers: {
                            "Content": "application/json",
                            "Accept": "application/json"
                        },
                        url: "http://localhost:3000/customers",
                        success: function (data) {
                            let recipients = [];
                            recipients = data;

                            $("#recipientName").empty();

                            recipients.forEach(item => {
                                if (item.id != customer.id) {
                                    let str = 
                                    `
                                    <option value="${item.id}">(${item.id}) ${item.fullName}</option>
                                    `;
                                    $("#recipientName").append(str);
                                }
                            })
                        }

                    })
                    $("#modalTransfer").modal("show");
                }).catch(function() {
                    alert("Customer not found");
                })
            })
        }

        function doTransfer() {

            transfer.senderId = customer.id;
            let customer_sender = transfer.senderId;
    
            let recipientId = $("#recipientName").val().id;
            transfer.fees = 10;
            transfer.transferAmount = +$("#transferAmount").val();
            transfer.feesAmount = transfer.transactionAmount / transfer.fees;
            transfer.transactionAmount = +$("#totalTransactionAmount").val();

            customer.balance += +transfer.transactionAmount;
            
            $.ajax({
                    type: "PUT",
                    headers: {
                        "Content": "application/json",
                        "Accept": "application/json"
                    },
                    url: "http://localhost:3000/customers/" + customer.id,
                    data: JSON.stringify(customer),
                    success: function (data) {
                        let str = `
                        <tr id="tr_${data.id}">
                            <td>${data.id}</td>
                            <td>${data.fullName}</td>
                            <td>${data.email}</td>
                            <td>${data.phone}</td>
                            <td>${data.address}</td>
                            <td>${data.balance}</td>
                            <td>
                                <button type="button" data-id="${data.id}" data-full-name="${data.fullName}" class="btn btn-outline-secondary btn-update">
                                    <i class="fa-solid fa-pen-to-square"></i>
                                </button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-outline-success btn-deposit" data-id="${data.id}">
                                    <i class="fa-solid fa-plus"></i>
                                </button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-outline-warning btn-withdraw" data-id="${data.id}">
                                    <i class="fa-solid fa-minus"></i>
                                </button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-outline-primary btn-transfer" data-id="${data.id}">
                                    <i class="fa-solid fa-arrow-right-arrow-left"></i>
                                </button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-outline-danger btn-delete" data-id="${data.id}"">
                                    <i class="fa-solid fa-ban"></i>
                                </button>
                            </td>
                        </tr>
                        `;

                        let currentRow = $("#tr_" + data.id);
                        currentRow.replaceWith(str);
                        $("#modalTransfer").modal("hide");

                        handlerShowUpdateModal();

                        handlerShowWithdrawModal();
                    }
                    })
        }

        // sau khi load xong cus thì load event show modal
        loadCustomers().then(function () {
            handlerShowUpdateModal();

            handlerShowDepositModal();

            handlerShowWithdrawModal();

            handlerShowDeleteModal();

            handlerShowTransferModal();
        });
    </script>
</body>

</html>